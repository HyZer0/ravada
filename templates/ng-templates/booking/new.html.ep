<!DOCTYPE html>
<html ng-app="ravada.app">
%= include 'bootstrap/header'
<body id="page-top" data-spy="scroll" data-target="fixed-top" role="document">
<div id="wrapper">
    %= include 'bootstrap/navigation'
<div id="page-wrapper"
                ng-controller="bookings"
                ng-init="init_new_booking()"
>
    <div class="page-header">
        <div class="card">
            <div class="card-header">
                <h2>Bookings</h2>
            </div>
        </div>
    </div>

<div ng-show="new_booking">
<form name="form_booking">


<div class="row">
    <div class="col-md-12">
        <input type="text" size="80" ng-model="booking.title" required/>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <label for="description">Description</label>
        <textarea ng-model="booking.description"></textarea>
    </div>
</div>
<div class="row">
    <div class="col-md-2">Start</div>
    <div class="col-md-5">
        <input type="date" ng-model="booking.date_start" ng-change="check_conflicts()"
            required/>
    </div>
</div>
<div class="row">
    <div class="col-md-2">End</div>
    <div class="col-md-5">
        <input type="date" ng-model="booking.date_end" ng-change="check_conflicts()"
            required/>
    </div>
</div>

<div class="row">
    <div class="col-md-2">Time</div>
    <div class="col-md-5">
        <input type="text" ng-model="booking.time_start" min="00:00" max="23:59"
            ng-change="check_conflicts()" required
        />
        <input type="text" ng-model="booking.time_end" min="00:00" max="23:59"/
            ng-change="check_conflicts()" required
        >
    </div>
</div>

<div class="row">
<%
my %dow = (
    1 => 'Monday'
    ,2 => 'Tuesday'
    ,3 => 'Wednesday'
    ,4 => 'Thursday'
    ,5 => 'Friday'
    ,6 => 'Saturday'
    ,7 => 'Sunday'
);
%>
    <div class="col-md-11">
%   for my $code (sort keys %dow ) {
        <input type="checkbox" name="dow_<%= $code %>"
            ng-true-value="<%= $code %>"
            ng-false-value="0"
            ng-change="update_booking_dow();check_conflicts()"
            ng-model="booking.dow[<%= $code-1 %>]"
        >
        <label for="dow_<%= $code %>"><%= $dow{$code} %></label>
%   }
   </div>
</div>
{{booking.dow}}

<div class="row">
    <div class="col-md-2">
        Base
    </div>
    <div class="col-md-2">
        <select ng-options="base.name for base in bases track by base.id"
        ng-model="booking.id_base" required></select>
    </div>
</div>


<div class="row">
    <div class="col-md-2">
        Group
    </div>
    <div class="col-md-2">
        <select ng-options="name for name in ldap_groups"
        ng-model="booking.ldap_group_new"></select>
    </div>
    <div class="col-md-2">
        <span ng-click="add_ldap_group(booking)"
            ng-show="booking.ldap_group_new"
            class="badge badge-primary">add</span>
    </div>
</div>

<div class="row" ng-show="typeof(group) != 'undefined'"
    ng-repeat="group in booking.ldap_groups">
    <div class="col-md-2">
    </div>
    <div class="col-md-2">
    {{group}}
    </div>

    <div class="col-md-2">
        <span ng-click="remove_ldap_group(booking,group)"
            class="badge badge-danger">remove</span>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
            <button ng-click="save_booking()"
                    ng-disabled="!form_booking.$valid || form_booking.$pristine
                        || booking.day_of_week == '0000000'
                        || ( booking.ldap_groups.length == 0 && !booking.ldap_group_new)
                        ">
                    save
            </button>
    </div>
</div>

</form>
</div>

<div ng-show="conflicts && conflicts.length">
    This booking overlaps already scheduled reservations
    <div ng-repeat="conflict in conflicts">
        {{conflict.date_booking}}
        <b>{{conflict.title}}</b></br>
        {{conflict.time_start}} - {{conflict.time_end}}
    </div>
</div>

<div ng-show="message_booking">
{{message_booking}}
</div>

<div ng-hide="new_booking">
    %= include '/main/vm_booking_list'
</div>
</div>

    %= include 'bootstrap/scripts'
    %= include 'bootstrap/messages'

</body>
</html>

